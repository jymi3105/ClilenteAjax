<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>ajax_05 - Seleccionar libros por editorial</title>
	<link rel="icon" type="image/x-icon" href="../recursos/favicon.ico">
	<style type="text/css">
		div {
			border: 2px solid red;
		}
	</style>
</head>

<body onload="peticionEditoriales();">
	<h1>ajax_05 - Seleccionar libros por editorial</h1>
	<hr />

	<br /><br />

	<!-- PASO 1: peticiÃ³n javascript -->
	Selecciona editorial<br />
	<select id="selectEditorial" onchange="peticionLibros();">
	</select>

	<br /><br />

	Selecciona libro<br />
	<select id="selectLibros"></select>

	<script type="text/javascript">

		function peticionEditoriales() {

			var peticion;
			if (window.XMLHttpRequest) {
				peticion = new XMLHttpRequest();
			} else if (window.ActiveXObject) {
				peticion = new ActiveXObject("Microsoft.XMLHTTP");
			}
			peticion.open('GET', 'ajax_05.php', true);
			peticion.send(null);

			peticion.onreadystatechange = function (evento) {
				if ((peticion.readyState == 4) && (peticion.status == 200)) {
					var libros =JSON.parse(peticion.responseText);
					var seleccion=document.getElementById("selectEditorial");

					for (let i = 0; i < libros.length; i++) {
						var opcion=document.createElement("option");
						opcion.innerHTML=libros[i];
						opcion.setAttribute("value", libros[i]);
						seleccion.appendChild(opcion);
					}
					peticionLibros();
					//console.log(libros[0]);
				}


			}

		}


		function peticionLibros() {
		
			var editorial=document.getElementById("selectEditorial").value;
			var peticion;
			if (window.XMLHttpRequest) {
				peticion = new XMLHttpRequest();
			} else if (window.ActiveXObject) {
				peticion = new ActiveXObject("Microsoft.XMLHTTP");
			}

			peticion.open('GET', 'ajax_05.php?editorial='+editorial, true);
			peticion.send(null);

			peticion.onreadystatechange = function (evento) {
				if ((peticion.readyState == 4) && (peticion.status == 200)) {
					var libros=JSON.parse(peticion.responseText);
					var selecion=document.getElementById("selectLibros");
					selecion.innerHTML="";

					for (let i = 0; i < libros.length; i++) {
						var text=libros[i].titulo;
						var opcion=document.createElement("option");
						opcion.innerHTML=text;
						opcion.setAttribute("value", libros[i].isbn);
						selecion.appendChild(opcion);
					}

					console.log(libros[0].titulo);

				}
			}

		}

	</script>
</body>

</html>