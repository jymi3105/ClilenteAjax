<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>ajax_14 - Ajax con jQuery - Rellenar datos de la tabla de libros</title>
	<link rel="icon" type="image/x-icon" href="../recursos/favicon.ico">
	<script type="text/javascript" src="../recursos/jquery-3.5.1.js"></script>
	<style>
		table,
		td {
			border: 2px solid black;
		}

		td {
			width: 200px;
		}

		th {
			border: 2px solid blue;
		}

		span {
			color: red;
		}

		#json {
			border: 1px solid purple;
		}
	</style>
</head>
<body">
	<h1>ajax_14 - Ajax con jQuery - Rellenar datos de la tabla de libros</h1>
	<hr />

	<button id="boton">Rellenar datos de libros</button>

	<br /><br />

	<table>
		<tr>
			<th>ISBN</th>
			<th>TÍTULO</th>
			<th>AUTOR</th>
			<th>EDITORIAL</th>
			<th>PÁGINAS</th>
			<th>PRECIO</th>
		</tr>
		<tr>
			<td>7</td>
			<td></td>
			<td>A1</td>
			<td></td>
			<td></td>
			<td>10</td>
		</tr>
		<tr>
			<td>11</td>
			<td></td>
			<td>A2</td>
			<td></td>
			<td></td>
			<td></td>
		</tr>
		<tr>
			<td>15</td>
			<td></td>
			<td></td>
			<td>E3</td>
			<td>100</td>
			<td></td>
		</tr>
		<tr>
			<td>34</td>
			<td></td>
			<td>A4</td>
			<td></td>
			<td></td>
			<td></td>
		</tr>
		<tr>
			<td>63</td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td>20</td>
		</tr>
		<tr>
			<td>71</td>
			<td></td>
			<td>A7</td>
			<td></td>
			<td></td>
			<td></td>
		</tr>
		<tr>
			<td>85</td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td>20</td>
		</tr>
	</table>
	<br><br>
	<div id="json"></div>

	<script type="text/javascript">

		$(document).ready(function () {
			$('#boton').click(function () {
				$('table tr').find('td:eq(0)').text(function (fila, isbn) {
					console.log("fila:" + fila + " isbn: " + isbn);
					$.ajax({
						url: "ajax_14.php",
						type: "get",
						//ESTE ES EL DATO QUE VA A ENVIAR AL SERVIDOR
						data: "isbn=" + isbn,
						dataType: "text",
						//FUNCION QUE SE EJECUTA EN CASO DE EXITO
						//LO QUE ME RETORNA EL SERVIDOR LO GESTIONO COMO DESCRIBA EN LA FUNCION
						success: function (datos, estado, xhr) {
							console.log(estado);
							var libros = JSON.parse(datos);
							var tamanmio = $('table tr:eq(' + (fila + 1) + ')').children('td').length;
							for (let i = 0; i < tamanmio; i++) {

								if ($('table tr:eq(' + (fila + 1) + ')').children('td:eq(' + i + ')').text() == '') {
									//console.log("No hay algo");
									switch (i) {
										case 1: $('table tr:eq(' + (fila + 1) + ')').children('td:eq(' + i + ')').text(libros.titulo); break;
										case 2: $('table tr:eq(' + (fila + 1) + ')').children('td:eq(' + i + ')').text(libros.autor); break;
										case 3: $('table tr:eq(' + (fila + 1) + ')').children('td:eq(' + i + ')').text(libros.editorial); break;
										case 4: $('table tr:eq(' + (fila + 1) + ')').children('td:eq(' + i + ')').text(libros.paginas); break;
										case 5: $('table tr:eq(' + (fila + 1) + ')').children('td:eq(' + i + ')').text(libros.precio).wrapInner('<span>'); break;
									}
								}
							}
						},
						error: function (xhr, estado, error) { alert(estado + " - " + error); }


					});
				});
			});
		});

	</script>
	</body>

</html>